package example.nz.org.take.compiler.userv.generated;

import nz.org.take.rt.*;


/**
 * Class generated by the take compiler.
 * @version Thu Sep 06 16:23:42 NZST 2007
 */
@SuppressWarnings("unchecked")
class KBFragement_getPolicyEligibility {
    /**
     * Method generated for query /insuranceEligibility[in,in,out]
     * @param car input parameter generated from slot 0
     * @param driver input parameter generated from slot 1
     * @return an iterator for instances of InsuranceEligibility
    */
    public static ResultSet<InsuranceEligibility> getPolicyEligibility(
        final example.nz.org.take.compiler.userv.domainmodel.Car car,
        final example.nz.org.take.compiler.userv.domainmodel.Driver driver) {
        DerivationController _derivation = new DefaultDerivationController();
        ResultSet<InsuranceEligibility> _result = new ResultSet(KBFragement_getPolicyEligibility.getPolicyEligibility(
                    car, driver, _derivation), _derivation);

        return _result;
    }

    /**
     * Method generated for query /insuranceEligibility[in,in,out]
     * @param car input parameter generated from slot 0
     * @param driver input parameter generated from slot 1
     * @return an iterator for instances of InsuranceEligibility
    */
    static ResourceIterator<InsuranceEligibility> getPolicyEligibility(
        final example.nz.org.take.compiler.userv.domainmodel.Car car,
        final example.nz.org.take.compiler.userv.domainmodel.Driver driver,
        final DerivationController _derivation) {
        final int _derivationlevel = _derivation.getDepth();
        ResourceIterator<InsuranceEligibility> result = new IteratorChain<InsuranceEligibility>(1) {
                public Object getIteratorOrObject(int pos) {
                    switch (pos) {
                    //  IF less_than_ii(eligibilityScore(<car>,<client>),100) THEN /insuranceEligibility(<car>,<client>,eligible)
                    case 0:
                        return getPolicyEligibility_0(car, driver,
                            _derivation.reset(_derivationlevel));

                    default:
                        return EmptyIterator.DEFAULT;
                    } // switch(pos)
                } // getIterator()

                public String getRuleRef(int pos) {
                    switch (pos) {
                    //  IF less_than_ii(eligibilityScore(<car>,<client>),100) THEN /insuranceEligibility(<car>,<client>,eligible)
                    case 0:
                        return "ES_04";

                    default:
                        return "";
                    } // switch(pos)
                } // getRuleRef()
            };

        return result;
    }

    /**
     * Method generated for query /insuranceEligibility[in,in,out]
     * @param car input parameter generated from slot 0
     * @param driver input parameter generated from slot 1
     * @return an iterator for instances of InsuranceEligibility
    */
    private static ResourceIterator<InsuranceEligibility> getPolicyEligibility_0(
        final example.nz.org.take.compiler.userv.domainmodel.Car car,
        final example.nz.org.take.compiler.userv.domainmodel.Driver driver,
        final DerivationController _derivation) {
        _derivation.log("ES_04", DerivationController.RULE, car, driver,
            DerivationController.NIL);

        // Variable bindings in rule:  IF less_than_ii(eligibilityScore(<car>,<client>),100) THEN /insuranceEligibility(<car>,<client>,eligible)
        class bindingsInRule33 {
            // Property generated for term  "eligibilityScore(<car>,<client>)"
            int p1;

            // Property generated for term  "<car>"
            example.nz.org.take.compiler.userv.domainmodel.Car p2;

            // Property generated for term  "<client>"
            example.nz.org.take.compiler.userv.domainmodel.Driver p3;

            // Property generated for term  "100"
            java.lang.Integer p4;

            // Property generated for term  "eligible"
            java.lang.String p5;
        }
        ;

        final bindingsInRule33 bindings = new bindingsInRule33();
        bindings.p2 = car;
        bindings.p4 = 100;
        bindings.p1 = Aggregations.eligibilityScore(car, driver);
        bindings.p3 = driver;
        bindings.p5 = "eligible";

        // code for prereq less_than_ii(eligibilityScore(<car>,<client>),100)
        final ResourceIterator<less_than_ii> iterator1 = KBFragement_less_than_ii_11.less_than_ii_11(Aggregations.eligibilityScore(
                    car, driver), 100, _derivation.increaseDepth());

        // code for prereq /insuranceEligibility(<car>,<client>,eligible)
        final ResourceIterator<InsuranceEligibility> iterator2 = new NestedIterator<less_than_ii, InsuranceEligibility>(iterator1) {
                public ResourceIterator<InsuranceEligibility> getNextIterator(
                    less_than_ii object) {
                    bindings.p1 = object.slot1;
                    bindings.p4 = 100;

                    return new SingletonIterator(new InsuranceEligibility(
                            bindings.p2, bindings.p3, bindings.p5));
                }
            };

        return iterator2;
    }
}
